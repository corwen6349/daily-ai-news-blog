{{ define "main" }}
<article class="post">
    <header class="post-header">
        <h1>{{ .Title }}</h1>
        <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006年01月02日" }}</time>
            {{ with .Params.categories }}
            <span class="categories">
                {{ range . }}
                <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}" class="category">{{ . }}</a>
                {{ end }}
            </span>
            {{ end }}
            <span class="view-count">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <span id="busuanzi_value_page_pv"></span> 次阅读
            </span>
        </div>
    </header>

    <div class="post-content">
        {{ .Content }}
    </div>

    {{ with .Params.tags }}
    <footer class="post-footer">
        <div class="tags">
            <strong>标签：</strong>
            {{ range . }}
            <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
            {{ end }}
        </div>
    </footer>
    {{ end }}
</article>

<!-- 平滑滚动脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 为所有内部锚点链接添加平滑滚动
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>

<nav class="post-nav">
    {{ if .PrevInSection }}
    <a href="{{ .PrevInSection.RelPermalink }}" class="prev">← {{ .PrevInSection.Title }}</a>
    {{ end }}
    {{ if .NextInSection }}
    <a href="{{ .NextInSection.RelPermalink }}" class="next">{{ .NextInSection.Title }} →</a>
    {{ end }}
</nav>

<!-- 评论区 -->
<div class="comments-section">
    <h3>评论</h3>
    <div id="gitalk-container"></div>
</div>

<!-- Gitalk -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
if (typeof Gitalk !== 'undefined') {
    const gitalk = new Gitalk({
        clientID: '{{ .Site.Params.gitalk.clientID }}',
        clientSecret: '{{ .Site.Params.gitalk.clientSecret }}',
        repo: '{{ .Site.Params.gitalk.repo }}',
        owner: '{{ .Site.Params.gitalk.owner }}',
        admin: ['{{ .Site.Params.gitalk.admin }}'],
        id: location.pathname,
        distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
}
</script>
{{ end }}
